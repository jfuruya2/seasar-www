<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- don't edit start -->
<head><title>Seasar - DI Container with AOP - </title><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<link href="../seasar_b.css" type="text/css" rel="stylesheet" media="screen"><script src="seasar_b.js" type="text/JavaScript" language="JavaScript"></script>
</head>
<BODY onload="preload('en')">
<TABLE cellSpacing=0 cellPadding=0 width="100%" align=left border=0>
  <TBODY>
  <TR>
    <TD vAlign=top align=left width=780>
      <TABLE class=white cellSpacing=0 cellPadding=0 width=780 border=0>
        <TBODY>
        <TR>
          <TD colSpan=7><IMG height=5 alt="" src="../images/top01_b.gif" 
            width=780></TD></TR>
        <TR>
          <TD width=235><IMG height=117 alt=Seasar 
            src="../images/top02_b.gif" width=235></TD>
          <TD colSpan=3><IMG height=117 alt="DI Container with AOP" 
            src="../images/top03.gif" width=289></TD>
          <TD colSpan=3><IMG height=117 alt="" 
            src="../images/spacer.gif" width=256></TD></TR>
<tr><td rowspan="2"><img src="../images/top04.gif" alt="" height="49" width="235"></td>
<td><a href="../index.html"><img src="../images/menu01_b_en.gif" height="30" width="78" border="0" alt="" id="menu01" onmouseover="swap(1)" onmouseout="restore(1)"></a></td>
<td><a href="../projects.html"><img src="../images/menu02_b_en.gif" height="30" width="101" border="0" alt="" id="menu02" onmouseover="swap(2)" onmouseout="restore(2)"></a></td>
<td><a href="../products.html"><img src="../images/menu06_b_en.gif" height="30" width="110" border="0" alt="" id="menu06" onmouseover="swap(6)" onmouseout="restore(6)"></a></td>
<td><a href="../documents.html"><img src="../images/menu04_b_en.gif" height="30" width="109" border="0" alt="" id="menu04" onmouseover="swap(4)" onmouseout="restore(4)"></a></td>
<td><a href="../resources.html"><img src="../images/menu05_b_en.gif" height="30" width="113" border="0" alt="" id="menu05" onmouseover="swap(5)" onmouseout="restore(5)"></a></td>
<!--
<td><img src="../images/menu07_b_en.gif" height="30" width="109" border="0" alt=""  id="menu07" onmouseover="swap(7)" onmouseout="restore(7)"></td>
//-->
<td><img height="30" width="34" src="../images/menu06.gif" alt=""></td></tr><tr>
        <TR>
          <TD colSpan=6><IMG height=19 alt="" src="../images/spacer.gif" 
            width=545></TD></TR></TBODY></TABLE>
      <TABLE class=white cellSpacing=0 cellPadding=0 width=780 border=0>
        <TBODY>
        <TR vAlign=top align=left>
          <TD width=18><IMG height=14 alt="" src="../images/spacer.gif" 
            width=18></TD>
          <TD class=main width=744><!-- don't edit end --><!-- document start -->
            <UL>
              <LI><A href="#diconInclude">Setting include path to a dicon file</A> 
              <LI><A href="#uuset">__set() Setter Injection</A> 

              <LI><A href="#ini-dicon">PHP Configuration File Format dicon File</A> 
              <UL>
                <LI><A href="#ini-components">components Section</A> 
                <LI><A  href="#ini-component">component Section</A> 
                <UL>
                  <LI type=circle><A 
                  href="#ini-arg">arg Settings</A> 
                  <LI type=circle><A href="#ini-property">property Settings</A> 
                  <LI type=circle><A href="#ini-init_method">init_method Settings</A> 
                  <LI type=circle><A href="#ini-destroy_method">destroy_method Settings</A> 
                  <LI type=circle><A href="#ini-aspect">aspect Settings</A> 
                  <LI type=circle><A href="#ini-meta">meta Settings</A> 
                  <LI type=circle><A href="#ini-etc">Miscellaneous</A> 
                  </LI></UL></LI></UL>
              <LI><A href="#dba">Database Connection</A> 
              <UL>
                <LI><A href="#dba-ds">Concerning DataSource</A> 
                <UL>
                  <LI type=circle><A href="#dba-ds-peardb">peardb.dicon Template</A> 
                  <LI type=circle><A href="#dba-ds-use">How to use</A> 
                  </LI></UL>
                <LI><A href="#dba-tx">Using TxIntereceptor</A> 
                <LI><A href="#dba-dao">Using SimpleDaoInterceptor</A> 
                <I>(This function has been moved to <A href="http://www.seasar.org/en/php5/s2dao.html">S2Dao.PHP5</A>)</I> 
                <UL>
                  <LI type=circle><A href="#dba-dao-array">Returning an Array</A>
                  <LI type=circle><A href="#dba-dao-bean">Returning an Object</A> 
                  </LI></UL></LI></UL>
              <LI><A href="#unit">S2Unit</A> 
              <UL>
                <LI><A href="#unit-example">Examples</A> 
                </LI></UL></LI></UL><BR><B>
            <H2>Extension</H2></B><A name=diconInclude>
            <H3>Setting include path to a dicon file</H3></A>
            <P>path attribute in an include tag in a dicon file may reference a constant by surrounding the constant name with a <SPAN class="enter">%</SPAN><BR></P><PRE>define(DICON_DIR,'/path/to/dir');   // constant definition

&lt;components&gt;
    &lt;include path="%DICON_DIR%/bar.dicon"/&gt;
&lt;/components&gt;
Warning: only path name <SPAN class="enter">starting</SPAN> with %...% is evaluated.
</PRE><BR><A name=uuset>
            <H3>__set() Setter Injection</H3></A>
            <P>Setter injection may be used with the newly introduced __set() in PHP5.</P>
            <UL>
              <LI>Property is explicitly specified (property tag is specified in the dicon file) 
              <LI>Sette method is not implemented by the class that is the target of injection
              <LI>Target class of injection implements __set() 
            </LI></UL>If one of the above conditions is true, __set() may be used to setter inject
<BR><BR><B>Create execution class</B> 

            <UL>
              <LI type=circle>Define setter method (setMessageA)
              <LI type=circle>Implement __set()
              <LI type=circle>Implement showMessage()</LI></UL>
            <P>Setter method for $messageB property is not defined</P><PRE>&lt;?php
class HelloImpl {

    private $messageA = "";
    private $messageB = "";

    function HelloImpl() {}
    
    function setMessageA($messageA){
        $this-&gt;messageA = $messageA;	
    }

    function __set($name,$val){
        $this-&gt;$name = $val;	
    }
    
    function showMessage(){
        print "{$this-&gt;messageA} {$this-&gt;messageB} \n";
    }
}
?&gt;
</PRE><BR><B>Create dicon file</B> 
            <UL>
              <LI type=circle>Define a component using component tag
              <LI type=circle>Set property value of a component in property tag which is a child of a component tag
              </LI></UL>
            <P>s2container.php5/src/examples/extension/uuset/uuset.dicon</P><PRE>&lt;components&gt;
    &lt;component class="HelloImpl"&gt;
        &lt;property name="messageA"&gt;"Hello"&lt;/property&gt;
        &lt;property name="messageB"&gt;"World"&lt;/property&gt;
    &lt;/component&gt;
&lt;/components&gt;
</PRE><BR><B>Create execution script</B> 
            <UL>
              <LI type=circle>Create S2Container by invoking S2ContainerFactory#create($path)
              <LI type=circle>Get component from the S2Container by invoking getComponent()
              <LI type=circle>Invoke on the method in the acquired component</LI></UL>
            <P>s2container.php5/src/examples/extension/uuset/uusetClient.php</P><PRE>&lt;?php
require_once(dirname(__FILE__) . '/uuset.inc.php');
$PATH = EXAMPLE_DIR . "/extension/uuset/uuset.dicon";
$container = S2ContainerFactory::create($PATH);
$hello = $container-&gt;getComponent('HelloImpl');
$hello-&gt;showMessage();
?&gt;
</PRE><BR><B>Result</B> 
            <P>Value of a property tag should be outputted as below:</P><PRE>% php uusetClient.php
Hello World
%
</PRE>Files in this example is available in the s2container.php5/src/examples/extension/uuset/ folder<BR><BR><A name=ini-dicon>
            <H3>dicon file in PHP configuration file format</H3></A>
            <P>dicon file is written in the same format as PHP configuration file (e.g. php.ini)<BR>There are <SPAN class="enter">components</SPAN> section and sections for each component.</P><PRE>[components]
namespace = "dao"
.....
.....
.....
[componentA]                ＋
class = "A"                 ｜
.....                       ｜
.....                       ｜  component selection
[componentB]                ｜
.....                       ｜
.....                       ｜
.....                       ▽

</PRE><A name=ini-components>
            <H3>components section</H3></A>
            <P>components section has 3 configuration items. If it is not necessary to specifgy configuration values in a components section, components section may be omitted.
            <TABLE cellSpacing=0 cellPadding=0 border=0 hspace="0" vspace="0">
              <TBODY>
              <TR>
                <TD>   -namespace</TD>
                <TD> ：</TD>
                <TD>Set namespace</TD></TR>
              <TR>
                <TD>   -include</TD>
                <TD> ：</TD>
                <TD>Specify path of a dicon file to include. Several paths may be included using include{index} syntax.</TD></TR>
              <TR>
                <TD vAlign=top>   -meta</TD>
                <TD vAlign=top> ：</TD>
                <TD>Set <A href="#ini-meta">meta data</A>
                </TD></TR></TBODY></TABLE></P><PRE>[components]
namespace = "dao"
include{0} = "/path/to/aaa.dicon"
include{1} = "/path/to/bbb.dicon"
meta{0}{name} = "metaA"
meta{0}{val}  = "meta data"
・・・
・・・
・・・
</PRE><A name=ini-component>
            <H3>component section</H3></A>
            <P>Set component name in component section to a component name. If class name is omitted, class name will default to the name of the component. Following 10 items may also be set in the component section:

            <TABLE cellSpacing=0 cellPadding=0 border=0 hspace="0" vspace="0">
              <TBODY>
              <TR>
                <TD>   -class</TD>
                <TD> ：</TD>
                <TD>Specify class name. If omitted, defaults to a class name</TD></TR>
              <TR>
                <TD>   -instance</TD>
                <TD> ：</TD>
                <TD>Specify <A href="DIContainer.html#InstanceMode">instance mode</A></TD></TR>
              <TR>
                <TD>   -autobinding</TD>
                <TD>：</TD>
                <TD>Specify <A href="DIContainer.html#AutoBindingMode">automatic binding mode</A></TD></TR>
              <TR>
                <TD>-exp</TD>
                <TD> ：</TD>
                <TD>Enter <A href="php.html">PHP expression</A></TD></TR>
              <TR>
                <TD>   -arg</TD>
                <TD> ：</TD>
                <TD>Specify <A href="#ini-arg">arguments to a constructor</A></TD></TR>
              <TR>
                <TD>   -property</TD>
                <TD> ：</TD>
                <TD>Set a <A href="#ini-property">property</A></TD></TR>
              <TR>
                <TD>   -init_method</TD>
                <TD> ：</TD>
                <TD>Set <A href="#ini-init_method">initMethod</A></TD></TR>
              <TR>
                <TD>   -destroy_method</TD>
                <TD> ：</TD>
                <TD>Set <A href="#ini-destroy_method">destroyMethod</A></TD></TR>
              <TR>
                <TD>   -aspect</TD>
                <TD> ：</TD>
                <TD>Set an <A href="#ini-aspect">aspect</A></TD></TR>
              <TR>
                <TD>   -meta</TD>
                <TD> ：</TD>
                <TD>Set a <A href="#ini-meta">meta data</A></TD></TR></TBODY></TABLE></P><PRE>[hello]
class = "Hello"
instance = "singleton"
autobinding = "auto"

arg{0}{val} = "hello world"
arg{1}{ref} = "bye"

property{0}{name} = "message"
property{0}{val} = "hello world 2 !!"

init_method{0}{name} = "initialize"
init_method{0}{arg{0}{val}} = "-1"

aspect{0}{pointcut} = "showMessage"
aspect{0}{exp} = "new TraceInterceptor()"

meta{0}{name} = "helloMeta"
meta{0}{ref} = "bye"

[bye]
class = "Bye"

...
...
...
</PRE><A name=ini-arg>
            <H3>Setting arg</H3></A>   -arg{index}{val} = value<BR>   -arg{index}{ref} = reference component<BR>   -arg{index}{exp} = PHP expression<BR>   -arg{index}{meta{0}{val}} = <A href="#ini-meta">Meta data</A><BR><PRE>[hello]
class=Hello
arg{0}{val} = "hello world"
arg{1}{ref} = bye
arg{2}{exp} = "array('hello','world','!!')"

[bye]
class = Bye
</PRE><A name=ini-property>
            <H3>Setting a property</H3></A>   -property{index}{name} = name of property to set<BR>   -property{index}{val} = value to set<BR>   -property{index}{ref} = specify component to reference<BR>   -property{index}{exp} = PHP expression<BR>   -property{index}{meta{0}{val}} = <A href="#ini-meta">Setting Meta data</A><BR><PRE>[hello]
class=Hello

property{0}{name} = "messageA"     --- set value "Hello" to messageA property
property{0}{val} = "Hello"
property{1}{name} = "messageB"     --- set "World" to messageB property
property{1}{val} = "World"
property{2}{name} = "bye"          --- set component "bye" to bye property
property{2}{ref} = "bye"

[bye]
class = Bye
</PRE><A name=ini-init_method>
            <H3>Setting init_method</H3></A>   -init_method{index}{name} = name of method to set<BR>   -init_method{index}{arg{0}{val}} = value of arguments<BR>   -init_method{index}{exp} = PHP expression<BR><PRE>[hello]
class=Hello

init_method{0}{name} = "showMessage"
init_method{0}{arg{0}{val}} = "Hello"
init_method{0}{arg{1}{val}} = "World"

init_method{1}{exp} = "$component-&gt;initialize()"

</PRE><A name=ini-destroy_method>
            <H3>Setting destroy_method</H3></A>
            <P>Similar to setting init_method</P><A name=ini-aspect>
            <H3>Setting aspect</H3></A>   -aspect{index}{pointcut} = pointcut<BR>   -aspect{index}{ref} = component to reference<BR>   -aspect{index}{exp} = PHP expression<BR><PRE>[hello]
class=Hello

aspect{0}{pointcut} = "showMessage"
aspect{0}{ref} = "trace"

[trace]
class = "TraceInterceptor"

</PRE><A name=ini-meta>
            <H3>Setting meta</H3></A>
            <P>meta{index}{name} sets meta name、meta{index}{val} sets a value</P>   -meta{index}{val} = value<BR>   -meta{index}{ref} = component to reference<BR>   -meta{index}{exp} = PHP expression<BR><PRE>[components]
meta{0}{name} = "metaA"
meta{0}{val} = "5"
meta{1}{name} = "metaB"
meta{1}{ref} = hello
meta{2}{name} = "metaC"
meta{2}{exp} = "array('a','b','c')"

[hello]
class = HelloImpl
</PRE><A name=ini-etc>
            <H3>Miscellaneous</H3></A>
            <UL>
              <LI>Single and double quoation may not be used in an item name (e.g. arg{0}{'val'}、arg{0}{"val"}) 
              <LI>If a value is surrounded by double quotes, line returns becomes effective
              <LI>index starts from value 0
              <LI>Both XML format and PHP configuration format dicon configuration files for examples under folder s2container.php5/src/examples/ are included.
              </LI></UL><BR><A name=dba>
            <H3>Database connection</H3></A>
            <P>Include database connection framework using <SPAN class="enter">extension</SPAN></P>
            <P>Following example uses the sample database table defined below. SQL script file (demo.sql) to create these tables is located in s2container.php5/src/s2container.php5/org/seasar/extension/db/sql/ folder.</P>Table: EMP 
            <TABLE class=main border=1>
              <TBODY>
              <TR align=middle bgColor=#d1f3f4>
                <TH>Column name</TH>
                <TH>Type</TH>
                <TH>NotNull</TH>
                <TH>Primary key</TH></TR>
              <TR>
                <TD>EMPNO</TD>
                <TD>NUMBER</TD>
                <TD align=middle>〇</TD>
                <TD align=middle>〇</TD></TR>
              <TR>
                <TD>ENAME</TD>
                <TD>VARCHAR</TD>
                <TD><BR></TD>
                <TD><BR></TD></TR>
              <TR>
                <TD>JOB</TD>
                <TD>VARCHAR</TD>
                <TD><BR></TD>
                <TD><BR></TD></TR>
              <TR>
                <TD>MGR</TD>
                <TD>NUMBER</TD>
                <TD><BR></TD>
                <TD><BR></TD></TR>
              <TR>
                <TD>HIREDATE</TD>
                <TD>DATE</TD>
                <TD><BR></TD>
                <TD><BR></TD></TR>
              <TR>
                <TD>SAL</TD>
                <TD>NUMBER</TD>
                <TD><BR></TD>
                <TD><BR></TD></TR>
              <TR>
                <TD>COMM</TD>
                <TD>NUMBER</TD>
                <TD><BR></TD>
                <TD><BR></TD></TR>
              <TR>
                <TD>DEPTNO</TD>
                <TD>NUMBER</TD>
                <TD><BR></TD>
                <TD><BR></TD></TR>
              <TR>
                <TD>TSTAMP</TD>
                <TD>TIMESTAMP</TD>
                <TD><BR></TD>
                <TD><BR></TD></TR></TBODY></TABLE><BR>Table: DEPT 
            <TABLE class=main border=1>
              <TBODY>
              <TR align=middle bgColor=#d1f3f4>
                <TH>Column name</TH>
                <TH>Type</TH>
                <TH>NotNull</TH>
                <TH>Primary key</TH></TR>
              <TR>
                <TD>DEPTNO</TD>
                <TD>NUMBER</TD>
                <TD align=middle>yes</TD>
                <TD align=middle>yes</TD></TR>
              <TR>
                <TD>DNAME</TD>
                <TD>VARCHAR</TD>
                <TD><BR></TD>
                <TD><BR></TD></TR>
              <TR>
                <TD>LOC</TD>
                <TD>VARCHAR</TD>
                <TD><BR></TD>
                <TD><BR></TD></TR>
              <TR>
                <TD>VERSIONNO</TD>
                <TD>NUMBER</TD>
                <TD><BR></TD>
                <TD><BR></TD></TR></TBODY></TABLE><A name=dba-ds>
            <H3>About DataSource</H3></A>
            <P>dicon configuration files containing native database connection configuration (DataSource) for MySQL, PostgreSQL, Pear DB, and ADOdb are available in the s2container.php5/src/s2container.php5/org/seasar/extension/db/ folder.</P>
            <TABLE cellSpacing=1 cellPadding=2 border=1 hspace="0" vspace="0">
              <TBODY>
              <TR align=middle bgColor=#d1f3f4>
                <TH></TH>
                <TH>XML format dicon file</TH>
                <TH>INI format dicon file</TH>
              <TR>
              <TR>
                <TD>native MySQL function</TD>
                <TD>mysql.dicon</TD>
                <TD>mysql.ini</TD>
              <TR>
              <TR>
                <TD>native PostgreSQL function</TD>
                <TD>postgres.dicon</TD>
                <TD>postgres.ini</TD>
              <TR>
              <TR>
                <TD><A href="http://pear.php.net/package/DB" target=_blank>Pear DB</A></TD>
                <TD>peardb.dicon</TD>
                <TD>peardb.ini</TD>
              <TR>
              <TR>
                <TD><A href="http://adodb.sourceforge.net/" target=_blank>ADOdb</A></TD>
                <TD>adodb.dicon</TD>
                <TD>adodb.ini</TD>
              <TR></TR></TBODY></TABLE>When using -Pear DB, specify to require DB.php.<BR>When using -ADOdb, specify to require adodb-exceptions.inc.php and adodb.inc.php.<BR><A name=dba-ds-peardb>
            <H3>peardb.dicon template</H3></A>
            <P>Following is the content of peardb.dicon template.
Properties of dataSource component should be set to values to properly connect to the database. If dsn properly is set, it will take precedence and be used.</P>
            <P>XML format peardb.dicon file</P><PRE>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE components PUBLIC "-//SEASAR//DTD S2Container//EN"
"components21.dtd"&gt;
&lt;components namespace="peardb"&gt;
    &lt;component name="dataSource" class="PearDBDataSource"&gt;
        &lt;property name="dsn"&gt;                                  
            "mysql://hoge:hoge@localhost:3306/s2container"       
        &lt;/property&gt;                                            
    &lt;/component&gt;

    &lt;component class="PearDBSqlHandler"/&gt;
    &lt;component name="dbtx" class="PearDBTxInterceptor"/&gt;
    &lt;component name="dao" class="SimpleDaoInterceptor"/&gt;
    &lt;component class="DaoMetaDataFactoryImpl"/&gt;
    &lt;component name="session" class="DBSessionImpl"/&gt;
&lt;/components&gt;
</PRE><BR>
            <P>INI format peardb.ini file</P><PRE>[components]
namespace="peardb"

[dataSource]
class="PearDBDataSource"

property{0}{name}="dsn"                                         
property{0}{val} ="mysql://hoge:hoge@localhost:3306/s2container"

[PearDBSqlHandler]

[dbtx]
class="PearDBTxInterceptor"

[dao]
class="SimpleDaoInterceptor"

[DaoMetaDataFactoryImpl]

[session]
class="DBSessionImpl"
</PRE><A name=dba-ds-use>
            <H3>Usage</H3></A>
            <P>In this example, DEPT table is queries with a key passed by an argument. A DOA to return the result is implemented.<BR>Files in this example is available in the s2container.php5/src/examples/extension/db/ folder.</P>
            <P><B>Interface Definition</B></P>
            <UL>
              <LI type=circle>Define DeptDao interface
              <LI type=circle>Define findDeptByDeptno method that will search by DEPTNO</LI></UL><PRE>&lt;?php
interface DeptDao {
    function findDeptByDeptno($deptno);
}
?&gt;
</PRE>
            <P><B>Create execution class</B></P>
            <UL>
              <LI type=circle>Create DeptDaoImpl class that implements DeptDao interface
              <LI type=circle>Pass DataSource as a constructor argument
              <LI type=circle>Implemnet findDeptByDeptno method. Obtain database connection using DataSource.</LI></UL><PRE>&lt;?php
class DeptDaoImpl implements DeptDao {

    private $dataSource;

    function DeptDaoImpl(DataSource $dataSource) {
        $this-&gt;dataSource = $dataSource;
    }
    
    function findDeptByDeptno($deptno){
        $db = $this-&gt;dataSource-&gt;getConnection();
        $result = $db-&gt;query("select * from dept where deptno = '{$deptno}';"); 
        $row = $result-&gt;fetchRow();
        $this-&gt;dataSource-&gt;disconnect($db);
        return $row;
    }
}
?&gt;
</PRE>Return value of DataSource-&gt;getConnection() is as follows:<BR>
            <TABLE cellSpacing=0 cellPadding=0 border=0 hspace="0" vspace="0">
              <TBODY>
              <TR>
                <TD>  When using -Pear DB</TD>
                <TD> :</TD>
                <TD>return value of DB::connect()</TD></TR>
              <TR>
                <TD>  When using -ADOdb</TD>
                <TD> :</TD>
                <TD>return value of NewADOConnection()</TD></TR>
              <TR>
                <TD>  When using -MySQL</TD>
                <TD> :</TD>
                <TD>return value of mysql_connect()</TD></TR>
              <TR>
                <TD>  When using -PostgreSQL</TD>
                <TD> :</TD>
                <TD>return value of pg_connect()</TD></TR></TBODY></TABLE>Which database connection string to use is specified in the following dicon file.<BR><BR>
            <P><B>Create dicon file</B></P>
            <P>Create a dicon file to use Pear DB. Specify peardb.dicon in an include tag.</P>
            <P>XML format deptDao.dicon</P><PRE>&lt;components&gt;
    &lt;include path="%S2CONTAINER_PHP5%/org/seasar/extension/db/peardb.dicon"/&gt;
    &lt;component name ="deptDao" class="DeptDaoImpl"/&gt;
&lt;/components&gt;
</PRE>
            <P>INI format deptDao.ini</P><PRE>[components]
include{0} = "%S2CONTAINER_PHP5%/org/seasar/extension/db/peardb.dicon"

[deptDao]
class="DeptDaoImpl"
</PRE>
            <P><B>Create execution script</B></P>
            <UL>
              <LI type=circle>Create a container using configuration file deptDao.dicon
              <LI type=circle>Get deptDao component from the container
              <LI type=circle>Invoke findDeptByDeptno to query on DEPTNO=10
</LI></UL>
            <P>dataSourceClient.php</P><PRE>&lt;?php
require_once(dirname(__FILE__) . '/db.inc.php');
$PATH = EXAMPLE_DIR . "/extension/db/deptDao.dicon";
//$PATH = EXAMPLE_DIR . "/extension/db/deptDao.ini";

$container = S2ContainerFactory::create($PATH);
$dao = $container-&gt;getComponent('deptDao');
$result = $dao-&gt;findDeptByDeptno(10);

print_r($result);
?&gt;
</PRE>
            <P><B>Result</B></P><PRE>% php dataSourceClient.php
Array
(
    [0] =&gt; 10
    [1] =&gt; ACCOUNTING
    [2] =&gt; NEW YORK
    [3] =&gt; 0
)
%
</PRE><A name=dba-tx>
            <H3>Use TxIntereceptor</H3></A>
            <P>Use TxInterceptor to manage database transaction.<BR>Files in this example is available in the s2container.php5/src/examples/extension/db/ folder.</P>
            <P><B>Interface Definition</B></P>
            <UL>
              <LI type=circle>Define DeptDao interface
              <LI type=circle>Define findDeptByDeptno method that inquires DEPTNO.</LI></UL><PRE>&lt;?php
interface DeptDao {
    function findDeptByDeptno($deptno);
}
?&gt;
</PRE>
            <P><B>Create execution class</B></P>
            <UL>
              <LI type=circle>Create TxDeptDaoImpl class that implements DeptDao interface
              <LI type=circle>Set a constructor to take DBSession as an argument
              <LI type=circle>Implement findDeptByDeptno method. Obtain database connection from DBSession
            </LI></UL>Database connection, close, transaction begin, and commit is done by TxInterceptor. Rollback when an exception is thrown.<PRE>&lt;?php
class TxDeptDaoImpl implements DeptDao {

    private $session;

    function TxDeptDaoImpl(DBSession $session) {
        $this-&gt;session = $session;
    }
    
    function findDeptByDeptno($deptno){
        $db = $this-&gt;session-&gt;getConnection();
        $result = $db-&gt;query("select * from dept where deptno = '{$deptno}';"); 
        $row = $result-&gt;fetchRow();

        return $row;
    }
}
?&gt;
</PRE>Return value of DBSession-&gt;getConnection() is as follows:<BR>
            <TABLE cellSpacing=0 cellPadding=0 border=0 hspace="0" vspace="0">
              <TBODY>
              <TR>
                <TD>  When using -Pear DB</TD>
                <TD> :</TD>
                <TD>return value of DB::connect()</TD></TR>
              <TR>
                <TD>  When using -ADOdb</TD>
                <TD> :</TD>
                <TD>return value of NewADOConnection()</TD></TR>
              <TR>
                <TD>  When using -MySQL</TD>
                <TD> :</TD>
                <TD>return value is mysql_connect()</TD></TR>
              <TR>
                <TD>  When using -PostgreSQL</TD>
                <TD> :</TD>
                <TD>return value is pg_connect()</TD></TR></TBODY></TABLE><BR><BR>
            <P><B>Creating a dicon file</B></P>
            <P>Use a dicon file for Pear DB. Specify peardb.dicon in an include tag. Aspect dbtx(PearDBTxInterceptor) to the findDeptByDeptno method.</P>
            <P>XML format txDeptDao.dicon</P><PRE>&lt;components&gt;
    &lt;include path="%S2CONTAINER_PHP5%/org/seasar/extension/db/peardb.dicon"/&gt;
    &lt;component name ="deptDao" class="TxDeptDaoImpl"&gt;
        &lt;aspect pointcut="findDeptByDeptno"&gt;
            dbtx
        &lt;/aspect&gt;
    &lt;/component&gt;
&lt;/components&gt;
</PRE>
            <P>INI format txDeptDao.ini</P><PRE>[components]
include{0} = "%S2CONTAINER_PHP5%/org/seasar/extension/db/peardb.dicon"

[deptDao]
class="TxDeptDaoImpl"
aspect{0}{pointcut} = "findDeptByDeptno"
aspect{0}{ref} = "dbtx"
</PRE>
            <P><B>Create execution script</B></P>
            <UL>
              <LI type=circle>Create a container using configuration file txDeptDao.dicon 
              <LI type=circle>Get deptDao component from the container
              <LI type=circle>Invoke findDeptByDeptno to query on DEPTNO=10
</LI></UL>
            <P>txClient.php</P><PRE>&lt;?php
require_once(dirname(__FILE__) . '/db.inc.php');

$PATH = EXAMPLE_DIR . "/extension/db/txDeptDao.dicon";
//$PATH = EXAMPLE_DIR . "/extension/db/txDeptDao.ini";

$container = S2ContainerFactory::create($PATH);
$dao = $container-&gt;getComponent('deptDao');
$result = $dao-&gt;findDeptByDeptno(10);
print_r($result);
?&gt;
</PRE>
            <P><B>Result</B></P><PRE>% php dataSourceClient.php
Array
(
    [0] =&gt; 10
    [1] =&gt; ACCOUNTING
    [2] =&gt; NEW YORK
    [3] =&gt; 0
)
%
</PRE><A name=dba-dao>
            <H3>Using SimpleDaoInterceptor<I> (This function has moved to <A href="http://www.seasar.org/en/php5/s2dao.html">S2Dao.PHP5</A>)</I></H3></A>
            <P>Define interfaces and connect to a database using SQL statement<BR>Files in this example is available in the s2container.php5/src/examples/extension/db/ folder.</P><A name=dba-dao-array>
            <H3>When an array is returned</H3></A>
            <P>Retrieve result of database query in an array</P>
            <P><B>Interface definition</B></P>
            <UL>
              <LI type=circle>Define DeptDao interface
              <LI type=circle>Define findDeptByDeptno method to query by DEPTNO
              <LI type=circle>Set SQL statement using constant annotation (QUERY)</LI></UL><PRE>&lt;?php
interface DeptDao {
    const findDeptByDeptno_QUERY = 'select * from dept where deptno = \'{$deptno}\'';
    //const findDeptByDeptno_FILE = '%PATH_PREFIX%/path/to/sql/file';
                                                  // specify external SQL file
    function findDeptByDeptno($deptno);
}
?&gt;
</PRE>
            <P>There are 3 methods to specify SQL statement that is executed by a method:<BR>- write SQL statement directly in constant annotation : <SPAN class="enter">method name</SPAN>_QUERY (above sample)<BR>   - Reference external file in constant annotation : <SPAN class="enter">method name</SPAN>_FILE (path of the external file is specified between %...%)<BR>   - Create file with SQL statements that is named <SPAN class="enter">interface name</SPAN>_<SPAN class="enter">method name</SPAN>.sql in the same folder as the interface definition file.<BR></P>
            <P><B>Create implementation class</B></P>
            <P>There isn't any implementation class in this example</P>
            <P><B>Create a dicon file</B></P>
            <P>Create a dicon file for to connect with ADOdb。include adodb.dicon file by specifying in an include tag. Apply aspect dao(SimpleDaoInterceptor) to findDeptByDeptno method.</P>
            <P>XML format simpleDeptDao.dicon</P><PRE>&lt;components&gt;
    &lt;include path="%S2CONTAINER_PHP5%/org/seasar/extension/db/adodb.dicon"/&gt;
    &lt;component name ="deptDao" class="DeptDao"&gt;
        &lt;aspect pointcut="findDeptByDeptno"&gt;
            dao
        &lt;/aspect&gt;
    &lt;/component&gt;
&lt;/components&gt;
</PRE>
            <P>INI format simpleDeptDao.ini</P><PRE>[components]
include{0} = "%S2CONTAINER_PHP5%/org/seasar/extension/db/adodb.dicon"

[deptDao]
class="DeptDao"
aspect{0}{pointcut} = "findDeptByDeptno"
aspect{0}{ref} = dao
</PRE>
            <P><B>Create execution script</B></P>
            <UL>
              <LI type=circle>Create a container using configuration file simpleDeptDao.dicon
              <LI type=circle>Get deptDao component from the container
              <LI type=circle>Invoke method findDeptByDeptno with DEPTNO(10)
</LI></UL>
            <P>simpleClient.php</P><PRE>&lt;?php
require_once(dirname(__FILE__) . '/db.inc.php');
$PATH = EXAMPLE_DIR . "/extension/db/simpleDeptDao.dicon";
//$PATH = EXAMPLE_DIR . "/extension/db/simpleDeptDao.ini";

$container = S2ContainerFactory::create($PATH);
$dao = $container-&gt;getComponent('deptDao');
$result = $dao-&gt;findDeptByDeptno(10);
print_r($result);
?&gt;
</PRE>
            <P><B>Result</B></P><PRE>% php simpleClient.php
Array
(
    [0] =&gt; Array
        (
            [0] =&gt; 10
            [1] =&gt; ACCOUNTING
            [2] =&gt; NEW YORK
            [3] =&gt; 0
        )
)
%
</PRE><A name=dba-dao-bean>
            <H3>When an object is returned</H3></A>
            <P>Get property value as an object referencing result from database query</P>
            <P><B>Interface definition</B></P>
            <UL>
              <LI type=circle>Define interface BeanDeptDao
              <LI type=circle>Define findDeptByDeptno method that searches by column DEPTNO
              <LI type=circle>Set DTO(Data Transfer Object) using constant annotation (BEAN)
              </LI></UL><PRE>&lt;?php
interface BeanDeptDao {
    const BEAN = "DeptDto";
    function findDeptByDeptno($deptno);
}
?&gt;
</PRE>
            <P>There are 3 methods to specify a SQL statement:<BR>   - write SQL statement directly in constant annotation : <SPAN class="enter">method name</SPAN>_QUERY<BR>   - Reference external file in constant annotation : <SPAN class="enter">method name_</SPAN>FILE (path of the external file is specified between %...%)<BR>   - Create file with SQL statements that is named <SPAN class="enter">interface name</SPAN>_<SPAN class="enter">method name</SPAN>.sql in the same folder as the interface definition file.<BR></P>
            <P>This example uses the third method and creates BeanDeptDao_findDeptByDeptno.sql file containing SQL statement to be executed by findDeptByDeptno and places this file in the same folder as BeanDeptDao interface definition file.<PRE>select * from dept where deptno = '{$deptno}'
</PRE>
            <P><B>Create execution class</B></P>
            <P>Create DTO specified by constant annotation (BEAN)</P><PRE>&lt;?php
class DeptDto {
    private $deptno;
    private $dname;
    
    function DeptDto() {}
    
    function setDeptno($deptno){
    	$this-&gt;deptno = $deptno;
    }
    function getDeptno(){
        return $this-&gt;deptno;	
    }
    
    function setDname($dname){
    	$this-&gt;dname = $dname;
    }
    function getDname(){
        return $this-&gt;dname;
    }

    function __toString(){
    	$str = "deptno = " . $this-&gt;deptno . ", dname = " . $this-&gt;dname;
        return $str;	
    }
}
?&gt;
</PRE>
            <P>Set DTO property specified by constant annotation (BEAN) to column name, DTO property, and setter method name that are result of a database query.</P>Association between column name, property, and setter method name
            <TABLE cellSpacing=1 cellPadding=2 border=1 hspace="0" vspace="0">
              <TBODY>
              <TR align=middle bgColor=#d1f3f4>
                <TH>Column name</TH>
                <TH>Property name</TH>
                <TH>Setter method name</TH>
              <TR>
              <TR>
                <TD>deptno</TD>
                <TD>deptno</TD>
                <TD>setDeptno</TD>
              <TR>
              <TR>
                <TD>dept_no</TD>
                <TD>deptNo</TD>
                <TD>setDeptNo</TD>
              <TR>
              <TR>
                <TD>DEPTNO</TD>
                <TD>deptno</TD>
                <TD>setDeptno</TD>
              <TR>
              <TR>
                <TD>DEPT_NO</TD>
                <TD>deptNo</TD>
                <TD>setDeptNo</TD>
              <TR></TR></TBODY></TABLE><BR>
            <P><B>Create dicon file</B></P>
            <P>Create a dicon file for ADOdb. include adodb.dicon by specifying the name in the include tag. Apply aspect dao(SimpleDaoInterceptor) to findDeptByDeptno method. (When using Pear DB, include peardb.dicon file instead.) </P>
            <P>XML format simpleDeptDao.dicon</P><PRE>&lt;components&gt;
    &lt;include path="%S2CONTAINER_PHP5%/org/seasar/extension/db/adodb.dicon"/&gt;
    &lt;component name ="beanDeptDao" class="BeanDeptDao"&gt;
        &lt;aspect pointcut="findDeptByDeptno"&gt;
            dao
        &lt;/aspect&gt;
    &lt;/component&gt;
&lt;/components&gt;
</PRE>
            <P>INI format simpleDeptDao.ini</P><PRE>[components]
include{0} = "%S2CONTAINER_PHP5%/org/seasar/extension/db/adodb.dicon"

[beanDeptDao]
class="BeanDeptDao"
aspect{0}{pointcut} = "findDeptByDeptno"
aspect{0}{ref} = dao
</PRE>
            <P><B>Create execution script</B></P>
            <UL>
              <LI type=circle>Create a container using configuration file simpleDeptDao.dicon
              <LI type=circle>Get component beanDeptDao from the container
              <LI type=circle>Invoke findDeptByDeptno method with setting DEPTNO(10)
</LI></UL>
            <P>simpleBeanClient.php</P><PRE>&lt;?php
require_once(dirname(__FILE__) . '/db.inc.php');
//$PATH = EXAMPLE_DIR . "/extension/db/simpleDeptDao.dicon";
$PATH = EXAMPLE_DIR . "/extension/db/simpleDeptDao.ini";

$container = S2ContainerFactory::create($PATH);
$dao = $container-&gt;getComponent('beanDeptDao');
$result = $dao-&gt;findDeptByDeptno(10);
print_r($result);
?&gt;
</PRE>
            <P><B>Result</B></P><PRE>% php simpleBeanClient.php
Array
(
    [0] =&gt; DeptDto Object
        (
            [deptno:private] =&gt; 10
            [dname:private] =&gt; ACCOUNTING
        )

)
%
</PRE>
            <P>Values are set to properties deptno and dname in DeptDto class. Columns LOC and VERSIONNO in the query result are thrown away.</P><BR><A name=unit>
            <H3>S2Unit</H3></A>
            <P>To make testing easier, S2 has a testing framework which is an extension of PHPUnit, PHPUnit2, and SimpleTest. Followings are its major features:</P>
            <UL>
              <LI>Create S2Container automatically on each test method (testXxx)
              <LI>register(), getComponent(), include() for S2Container are made to available 
              <LI>If there is a public field in TestCase and if there is a component in a S2Container with the same name as the field name, it is automatically set
              <LI>After the test method ends, all automatically set variables are set to null
              <LI>If a test method (testXxx) is defined that corresponds to setUpXxx() and tearDownXxx(), it is invoked after setUp() and before testDown(). Initialization and clean up processes may be specified here.
              </LI></UL>
            <H3><A name=unit-example>Example</A></H3>
            <P>Use S2PHPUnit2TestCase that extends Pear PHPUnit2.<BR>Files in this example is available in the s2container.php5/src/examples/extension/unit/ folder.</P>
            <P><B>Target of the test</B></P>
            <P>s2container.php5/src/examples/extension/unit/src/foo/FooLogic.class.php</P><PRE>&lt;?php
class FooLogic {

    function FooLogic() {
    }
    
    function showYear(){
    	return 2005;
    }
}
?&gt;
</PRE>
            <P><B>dicon file</B></P>
            <P>s2container.php5/src/examples/extension/unit/src/foo/foo.ini</P><PRE>[logic]
class = FooLogic
</PRE>
            <P><B>Test class</B></P>
            <P>s2container.php5/src/examples/extension/unit/test/phpunit2/foo/FooLogicTest.class.php</P><PRE>&lt;?php
class FooLogicTest extends S2PHPUnit2TestCase {

    public $logic;   //--- if there is a definition of component named "logic"
                     //--- in a dicon file, it is set
    
    function __construct($name) {
    	parent::__construct($name);
    }

    function setUp(){
        $this-&gt;includeDicon(UNIT_EXAMPLE . "/src/foo/foo.ini");   //--- include dicon file
    }

    function testShowYear(){
        $year = $this-&gt;logic-&gt;showYear();
        $this-&gt;assertEquals($year , 2005);	
    }
}
?&gt;
</PRE>
            <P>s2container.php5/src/examples/extension/unit/test/phpunit2/foo/FooAllTest.class.php</P><PRE>&lt;?php
class FooAllTest {

    public static function main() {
        PHPUnit2_TextUI_TestRunner::run(self::suite());
    }
    
    public static function suite() {
        $suite = new PHPUnit2_Framework_TestSuite();
        $suite-&gt;addTestSuite('FooLogicTest');
        return $suite;  
    }
}
?&gt;
</PRE>
            <P><B>Execution script</B></P>
            <P>s2container.php5/src/examples/extension/unit/test/phpunit2/foo/fooTests.php</P><PRE>&lt;?php
define('PHPUnit2_MAIN_METHOD', 'FooAllTest::main()');
require_once 'PHPUnit2/Framework/TestSuite.php';
require_once 'PHPUnit2/TextUI/TestRunner.php';

FooAllTest::main();
?&gt;
</PRE>
            <P><B>Result</B></P><PRE>% php allTests.php

TEST : FooLogicTest::testShowYear
------------------------------------

.

Time: 0.368033

OK (1 test)
%
</PRE>
            <P>Similar examples using Pear PHPUnit and SimpleTest are available in the s2container.php5/src/examples/extension/unit/test/ folder.</P><!-- document end --><!-- don't edit start --></TD>
          <TD width=14><IMG height=14 alt="" src="../images/spacer.gif" 
            width=14></TD></TR>
        <TR>
          <TD width=14><IMG height=30 alt="" src="../images/spacer.gif" 
            width=14></TD>
          <TD width=766><IMG height=30 alt="" src="../images/spacer.gif" 
            width=592></TD></TR>
        <TR>
          <TD width=14><IMG height=14 alt="" src="../images/spacer.gif" 
            width=14></TD>
<TD class=copyright><TABLE cellSpacing=0 cellPadding=0 width=736><TR><TD align="left">Trans. by H.Ozawa</TD><TD align="right">Copyright&copy; 2004-2005, The Seasar Foundation and 
            the others. All rights reserved.</TD></TR></TABLE></TD></TR></TBODY></TABLE></TD>
    <TD class=backright vAlign=top align=left>&nbsp;</TD></TR>
  <TR>
    <TD class=backunder vAlign=top align=left width=780 height=16>&nbsp;</TD>
    <TD class=backcorner vAlign=top align=left 
height=16>&nbsp;</TD></TR></TBODY></TABLE><!-- don't edit end --></BODY></HTML>
